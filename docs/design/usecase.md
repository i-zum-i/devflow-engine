はい、承知いたしました。
システム「**DevFlow Engine**」の全てのユースケースを洗い出し、Mermaidによるユースケース図と、詳細なユースケース定義を作成します。

-----

## 1\. アクターの定義

本システムに関わるアクター（利用者や外部システム）は以下の通りです。

  * **開発者 (Developer)**: 本システムの主要な利用者。プロンプトの入力、コードの編集、PRの確認を行う。
  * **システム管理者 (System Administrator)**: 本システムのセットアップ、認証情報の設定、および運用監視を行う。
  * **GitHub**: 外部連携システム。リポジトリの操作やPR作成APIを提供する。

-----

## 2\. ユースケース図 (Mermaid)

各アクターと、システム「DevFlow Engine」が提供するユースケースの関係性を図示します。

```mermaid
use case diagram
    title DevFlow Engine ユースケース図

    actor "開発者" as Dev
    actor "システム管理者" as Admin
    actor "GitHub" as ExtGitHub

    rectangle "DevFlow Engine システム" {
        usecase UC001 as "PRを自動作成する"
        usecase UC002 as "追加の修正を指示する"
        usecase UC003 as "コードを手動で編集する"
        usecase UC004 as "作業履歴を確認する"
        usecase UC005 as "開発環境を終了する"
        usecase UC006 as "システムを初期設定する"
        usecase UC007 as "システムを監視・運用する"
    }

    Dev -- UC001
    Dev -- UC002
    Dev -- UC003
    Dev -- UC004
    Dev -- UC005

    Admin -- UC006
    Admin -- UC007

    UC002 .> UC001 : <<extend>>
    UC003 .> UC001 : <<extend>>
    UC005 .> UC001 : <<extend>>

    UC001 -- ExtGitHub
    UC002 -- ExtGitHub
    UC003 -- ExtGitHub
    UC006 -- ExtGitHub```

-----

## 3\. ユースケース定義

### **開発者向けユースケース**

| ユースケースID | UC-001 |
| :--- | :--- |
| **ユースケース名** | **PRを自動作成する** |
| **アクター** | 開発者 |
| **概要** | 開発者が指定したGitHubリポジトリと自然言語プロンプトを基に、システムがコード編集からプルリクエスト作成までを完全に自動化する。 |
| **事前条件** | \<ul\>\<li\>開発者はシステムにアクセス可能である。\</li\>\<li\>対象のGitHubリポジトリが存在し、システム（GitHub App）がインストールされている。\</li\>\</ul\> |
| **事後条件** | \<ul\>\<li\>指定されたリポジトリに新しいブランチが作成される。\</li\>\<li\>プロンプトに基づいたコード変更がコミット＆プッシュされる。\</li\>\<li\>変更内容を含むプルリクエストがGitHub上に作成される。\</li\>\<li\>開発者のUIに、作成されたPRへのリンクと実行結果が表示される。\</li\>\<li\>開発用のECSコンテナが起動し、セッションが開始される。\</li\>\</ul\> |
| **基本フロー** | \<ol\>\<li\>開発者はWeb UIでGitHubリポジトリのURLと初回プロンプトを入力し、「実行」ボタンを押す。\</li\>\<li\>システムはリクエストを受け付け、バックエンドでECSコンテナを起動する。\</li\>\<li\>コンテナはリポジトリをクローンし、新しいブランチを作成する。\</li\>\<li\>コンテナはAIを用いてプロンプトを解釈し、コードを非対話形式で編集する。\</li\>\<li\>コンテナは変更内容をコミットし、GitHubにプッシュする。\</li\>\<li\>コンテナはGitHub APIを利用してプルリクエストを作成する。\</li\>\<li\>システムはUI上にPRへのリンク、プロンプト内容、PRコメントの履歴を表示する。\</li\>\</ol\> |

| ユースケースID | UC-002 |
| :--- | :--- |
| **ユースケース名** | **追加の修正を指示する** |
| **アクター** | 開発者 |
| **概要** | 進行中のセッション（起動中のコンテナ）に対し、追加のプロンプトを送信してさらなるコード修正を指示する。 |
| **事前条件** | \<ul\>\<li\>UC-001が完了し、セッションが進行中である。\</li\>\</ul\> |
| **事後条件** | \<ul\>\<li\>既存の作業ブランチに、追加のコード変更がコミット＆プッシュされる。\</li\>\<li\>既存のプルリクエストが新しいコミットで更新される。\</li\>\<li\>UIの履歴に、追加のプロンプトと実行結果が追記される。\</li\>\</ul\> |
| **基本フロー** | \<ol\>\<li\>開発者はUIの入力欄に新しいプロンプトを入力し、「実行」ボタンを押す。\</li\>\<li\>システムはリクエストを受け付け、セッションに紐づく実行中のコンテナに追加指示を送信する（ECS Exec）。\</li\>\<li\>コンテナはAIを用いてコードを再度編集する。\</li\>\<li\>コンテナは変更内容をコミットし、GitHubにプッシュする。\</li\>\<li\>システムはUIの履歴を更新する。\</li\>\</ol\> |

| ユースケースID | UC-003 |
| :--- | :--- |
| **ユースケース名** | **コードを手動で編集する** |
| **アクター** | 開発者 |
| **概要** | 自動編集されたコードを確認し、微調整を加えるために、WebベースのIDE（code-server）にアクセスする。 |
| **事前条件** | \<ul\>\<li\>UC-001が完了し、セッションが進行中である。\</li\>\</ul\> |
| **事後条件** | \<ul\>\<li\>開発者のブラウザで、対象リポジトリのコードが開かれたWeb IDEのタブが表示される。\</li\>\</ul\> |
| **基本フロー** | \<ol\>\<li\>開発者はUI上の「Editor」ボタンを押す。\</li\>\<li\>システムは実行中のコンテナのIPアドレスから`code-server`へのURLを生成して返す。\</li\>\<li\>ブラウザが新しいタブでWeb IDEを開く。\</li\>\<li\>開発者はIDE上でコードを自由に編集し、ターミナルから`git`コマンドなどを実行できる。\</li\>\</ol\> |

| ユースケースID | UC-004 |
| :--- | :--- |
| **ユースケース名** | **作業履歴を確認する** |
| **アクター** | 開発者 |
| **概要** | 現在のセッションで行われた一連のプロンプト入力と、それによって生成されたPRコメントやリンクの履歴を時系列で確認する。 |
| **事前条件** | \<ul\>\<li\>UC-001が完了している。\</li\>\</ul\> |
| **事後条件** | \<ul\>\<li\>なし。\</li\>\</ul\> |
| **基本フロー** | \<ol\>\<li\>開発者はUIの履歴表示エリアを閲覧する。\</li\>\<li\>システムはセッションに紐づく全ての実行履歴（プロンプト、PRコメント、PRリンク）を表示する。\</li\>\</ol\> |

| ユースケースID | UC-005 |
| :--- | :--- |
| **ユースケース名** | **開発環境を終了する** |
| **アクター** | 開発者 |
| **概要** | 作業が完了したセッションの開発環境（ECSコンテナ）を破棄し、リソースを解放する。 |
| **事前条件** | \<ul\>\<li\>UC-001が完了し、セッションが進行中である。\</li\>\</ul\> |
| **事後条件** | \<ul\>\<li\>ECSコンテナが停止・破棄される。\</li\>\<li\>UIが初期状態に戻る。\</li\>\</ul\> |
| **基本フロー** | \<ol\>\<li\>開発者はUI上の「Clear」ボタンを押す。\</li\>\<li\>システムはセッションに紐づくECSコンテナを停止するようバックエンドにリクエストする。\</li\>\<li\>バックエンドがコンテナを停止し、セッション情報をDBから削除する。\</li\>\<li\>システムはUIをリフレッシュし、初期画面を表示する。\</li\>\</ol\> |

-----

### **システム管理者向けユースケース**

| ユースケースID | UC-006 |
| :--- | :--- |
| **ユースケース名** | **システムを初期設定する** |
| **アクター** | システム管理者 |
| **概要** | DevFlow Engineを稼働させるために必要なAWSリソースのデプロイと、GitHub Appの作成・認証情報の設定を行う。 |
| **事前条件** | \<ul\>\<li\>AWSアカウントとGitHub Organizationの管理者権限を持っている。\</li\>\</ul\> |
| **事後条件** | \<ul\>\<li\>フロントエンドとバックエンドのアプリケーションがデプロイされる。\</li\>\<li\>GitHub Appが作成され、対象リポジトリにインストールされる。\</li\>\<li\>GitHub Appの認証情報（App ID, Private Keyなど）がAWS Secrets Managerに安全に保管される。\</li\>\</ul\> |
| **基本フロー** | \<ol\>\<li\>システム管理者は、IaC（Infrastructure as Code）スクリプトなどを実行し、AWSリソース（API Gateway, Lambda, DynamoDB, ECSなど）をデプロイする。\</li\>\<li\>システム管理者はGitHub上でGitHub Appを作成し、必要な権限（Contents, Pull RequestsのRead/Write）を設定する。\</li\>\<li\>システム管理者はAppの秘密鍵を生成・ダウンロードし、App IDなどと共にAWS Secrets Managerに登録する。\</li\>\<li\>システム管理者は対象リポジトリにGitHub Appをインストールする。\</li\>\</ol\> |

| ユースケースID | UC-007 |
| :--- | :--- |
| **ユースケース名** | **システムを監視・運用する** |
| **アクター** | システム管理者 |
| **概要** | システムの稼働状況（ログ、メトリクス）を監視し、コストを管理する。また、問題発生時にトラブルシューティングを行う。 |
| **事前条件** | \<ul\>\<li\>UC-006が完了し、システムが稼働中である。\</li\>\</ul\> |
| **事後条件** | \<ul\>\<li\>システムの安定稼働が維持される。\</li\>\</ul\> |
| **基本フロー** | \<ol\>\<li\>システム管理者はAmazon CloudWatch LogsでLambdaやECSコンテナのログを確認する。\</li\>\<li\>システム管理者はCloudWatch Metricsで各サービスのパフォーマンスを監視する。\</li\>\<li\>システム管理者はAWS Cost Explorerなどで、ECS Fargateの利用料金などを定期的に確認する。\</li\>\<li\>システム管理者は、必要に応じてライブラリのアップデートや設定の変更を行う。\</li\>\</ol\> |